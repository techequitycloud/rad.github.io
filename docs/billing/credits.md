---
title: Credits System
sidebar_position: 1
description: Understanding RAD Platform credits system - how credits work, pricing, purchasing, and managing your infrastructure budget
keywords: ['credits', 'billing', 'pricing', 'cost management', 'infrastructure costs']
---

# Credits System


This document provides a comprehensive technical overview of the Credits and Billing Management System. It is intended for engineers and technical staff responsible for maintaining and extending the platform.

## 1. Admin-Facing Features (Credit Settings)

The "Credit Settings" tab, located under the "Billing" page, provides administrators with a suite of tools to configure the economic model of the platform. These settings are stored in the `settings` collection in Firestore.

### 1.1. Implementation Details

-   **Frontend Component**: `rad-ui/webapp/src/routes/Billing.tsx` is the main container. It renders `rad-ui/webapp/src/components/AdminCreditForms.tsx` which holds the individual setting forms.
-   **Backend API Endpoint**: `/api/settings` is the primary endpoint for updating these settings.

### 1.2. Forms and Features

#### 1.2.1. Subscription Tiers

The Subscription Tiers feature allows administrators to create, manage, and delete different subscription levels that users can purchase to acquire credits.

-   **Frontend Component**: `rad-ui/webapp/src/components/SubscriptionTierManagement.tsx`
-   **Backend API Endpoint**: `/api/subscriptions/tiers` and `/api/subscriptions/tiers/[id]`
-   **Functionality**: Manages subscription levels for one-time credit purchases.

#### 1.2.2. Signup Credits

-   **Purpose**: To automatically grant "awarded" credits to new users.
-   **Component**: `SignupCreditForm.tsx`
-   **Settings**:
    -   `signupCreditAmount`: The number of credits to award.
    -   `monthlySignUpCredit`: If true, the `signupCreditAmount` is awarded to all users monthly.

#### 1.2.3. Adjust All User Credits

-   **Purpose**: To manually add or remove "awarded" credits for all users.
-   **Component**: `CreditAdjustmentForm.tsx`
-   **Endpoint**: `POST /api/credit/adjust`

#### 1.2.4. Referral Credits

-   **Purpose**: To award credits to a referrer when a new user signs up.
-   **Component**: `ReferralCreditForm.tsx`
-   **Setting**: `referralCreditAmount`

#### 1.2.5. Low Credit Notification

-   **Purpose**: To configure the threshold for the low credit email notification.
-   **Component**: `LowCreditForm.tsx`
-   **Setting**: `lowCreditTriggerAmount`

#### 1.2.6. Price Per Unit

-   **Purpose**: To establish the currency-to-credit conversion rate.
-   **Component**: `PricePerCreditForm.tsx`
-   **Setting**: `creditsPerUnit`

#### 1.2.7. Refresh Interval

-   **Purpose**: To set the interval for the recurring billing function (`project_credits`).
-   **Component**: `RefreshIntervalForm.tsx`
-   **Setting**: `refreshInterval` (in hours)

#### 1.2.8. Revenue Share

-   **Purpose**: To set the revenue share percentage for partners.
-   **Component**: `RevenueShareForm.tsx`
-   **Setting**: `revenueShare` (as a percentage)

#### 1.2.9. Partner Credits

-   **Purpose**: To grant monthly credit allowances to users who cannot purchase credits through the standard subscription service.
-   **Component**: Integrated within the User Credits management interface
-   **Setting**: `creditPartner` (per-user monthly allowance)
-   **Functionality**: Administrators can set a monthly credit allowance for individual users. These credits are automatically granted at the beginning of each month and are treated identically to purchased credits, allowing unrestricted use across all modules including those requiring purchased credits.

## 2. Reporting and Management Tabs

### 2.1. User Credits

This tab allows administrators to view and manage the credit balances of individual users, including the new Partner Credits allowance feature.

-   **Frontend Component**: Implemented directly within `rad-ui/webapp/src/routes/Billing.tsx`.
-   **Backend API Endpoint**: `PUT /api/users/[userId]`
-   **Partner Column**: A new "Partner" column displays each user's monthly credit allowance. Administrators can click "Edit" to set or modify the `creditPartner` value, which represents the monthly allowance of credits the user will receive automatically.

### 2.2. Project Costs

A reporting tool that provides a detailed breakdown of the actual costs incurred by projects from the cloud provider's billing data.

-   **Frontend Component**: `rad-ui/webapp/src/components/ProjectCosts.tsx`
-   **Backend API Endpoint**: `GET /api/costs`
-   **Data Source**: BigQuery billing export.

### 2.3. Module Revenue / Project Revenue

This tab provides a report of the "true revenue" generated by each module, which is revenue from "purchased" credits.

-   **Frontend Component**: `rad-ui/webapp/src/components/ProjectRevenue.tsx`
-   **Backend API Endpoint**: `GET /api/revenue`

### 2.4. User Revenue

Provides a report of "true revenue" generated by specific users, crucial for the 'Agent' role.

-   **Frontend Component**: `rad-ui/webapp/src/components/UserRevenue.tsx`
-   **Backend API Endpoint**: `GET /api/revenue` (scoped by user role).

## 3. Automated Backend System (Cloud Functions)

The system uses a set of independent, event-driven Google Cloud Functions to handle the credit lifecycle asynchronously.

### 3.1. `notification_status` Function

-   **Purpose**: Processes deployment status updates and handles the one-time credit deduction for new, successful deployments.
-   **Trigger**: Pub/Sub messages from Google Cloud Build.
-   **Key Logic**: Deducts credits only when a deployment's `action` is "CREATE" and `appStatus` is "SUCCESS".

### 3.2. `project_credits` Function

-   **Purpose**: The recurring billing engine that charges users for their actual cloud resource consumption.
-   **Trigger**: Cloud Scheduler (frequency is based on the `refreshInterval` setting).
-   **Key Logic**: Queries BigQuery for costs and deducts credits. If a user has insufficient funds, it disables billing for their GCP projects via the Cloud Billing API as a safety mechanism.

### 3.3. `low_credit` Function

-   **Purpose**: Proactively notifies users when their credit balance falls below the `lowCreditTriggerAmount`.
-   **Trigger**: Cloud Scheduler (typically daily).
-   **Key Logic**: Checks user balance against the threshold and sends a throttled email notification.

### 3.4. `creditPartner` Function

-   **Purpose**: Automated monthly granting of Partner Credits to eligible users.
-   **Trigger**: Cloud Scheduler (runs at midnight UTC on the 1st of each month).
-   **Key Logic**: 
    - Iterates through all users in the system
    - Checks each user's `creditPartner` allowance value
    - If the allowance is greater than zero, adds that amount to the user's `creditPurchases` balance
    - Creates a transaction history entry with type "PARTNER" for audit trail purposes
-   **Implementation**: This function ensures Partner Credits are seamlessly integrated with the existing credit system by adding them directly to the purchased credits balance, making them functionally identical to credits acquired through payment.


## 4. Partner Credits: Detailed Overview

Partner Credits is a specialized credit management feature designed to support users who cannot access the standard subscription payment system. This feature allows administrators to grant monthly credit allowances that function identically to purchased credits.

### 4.1. Use Cases

Partner Credits are ideal for:

- **International users** in regions where payment processing is unavailable
- **Partner organizations** receiving credits as part of partnership agreements
- **Testing and demonstration** accounts requiring ongoing credit allocation
- **Special programs** such as educational initiatives or non-profit support
- **Users with payment restrictions** who still need full platform access

### 4.2. How Partner Credits Work

#### 4.2.1. Two-Step Process

The Partner Credits system operates through a simple two-step workflow:

**Step 1: Administrator Configuration**
- Navigate to **Billing → User Credits** tab
- Locate the "Partner" column in the user table
- Click "Edit" for the target user
- Enter a numeric value representing the monthly credit allowance
- This value is stored in the user's `creditPartner` field

**Step 2: Automated Monthly Granting**
- The `creditPartner` Cloud Function runs automatically on the 1st of each month at midnight UTC
- The function checks every user's `creditPartner` allowance
- If the allowance is greater than zero, that amount is added to `creditPurchases`
- A transaction record with type "PARTNER" is created for audit purposes

#### 4.2.2. Credit Type and Usage

Partner Credits are added directly to the user's `creditPurchases` balance, which means:

- **Functionally identical to purchased credits**: The system treats them exactly like credits acquired through payment
- **No usage restrictions**: Can be used for any module deployment, including modules with the `require_credit_purchases` flag enabled
- **No expiration**: Credits remain in the account until spent on deployments
- **Cumulative**: Each month's allowance adds to the existing balance

### 4.3. Credit Evaluation and Deduction

When a user initiates a deployment, the system evaluates credits using the standard process:

**Available Credits Calculation**
```
Total Available = creditAwards + creditPurchases
```

Since Partner Credits are added to `creditPurchases`, they are automatically included in this calculation.

**Deployment Authorization**
1. System compares deployment cost against total available credits
2. If sufficient credits exist, deployment proceeds
3. If insufficient, deployment is blocked with a low balance message

**Post-Deployment Deduction**
After successful deployment completion:

- **For modules requiring purchased credits**: Cost is deducted from `creditPurchases` (which includes Partner Credits)
- **For modules accepting any credit type**: Cost is deducted from `creditAwards` first, then from `creditPurchases` if needed

This ensures Partner Credits can be used for all deployment types without restriction.

### 4.4. Transaction History and Audit Trail

Every Partner Credit grant creates a transaction record with:

- **Type**: "PARTNER"
- **Amount**: The monthly allowance granted
- **Timestamp**: Date and time of the automated grant
- **User**: The recipient user ID
- **Balance**: Updated `creditPurchases` balance after grant

This provides complete transparency and auditability for financial reporting and compliance purposes.

### 4.5. Administrative Workflow

#### Setting Up Partner Credits

1. **Identify eligible users** based on partnership agreements or special circumstances
2. **Navigate to Billing → User Credits** in the admin interface
3. **Review the Partner column** to see existing allowances
4. **Click Edit** for the target user
5. **Enter the monthly allowance** amount (e.g., 100 for 100 credits per month)
6. **Save the configuration**
7. **Verify** the allowance appears in the Partner column

#### Modifying Partner Credits

To change an existing allowance:

1. **Locate the user** in the User Credits table
2. **Click Edit** to open the user details
3. **Update the Partner field** with the new monthly amount
4. **Save changes**
5. The new allowance takes effect starting the next month

To remove Partner Credits:

1. **Edit the user's Partner field**
2. **Set the value to 0** (zero)
3. **Save changes**
4. No further credits will be granted, but existing balance remains

#### Monitoring Partner Credits

Administrators can track Partner Credits through:

- **User Credits table**: View current `creditPartner` allowances for all users
- **Transaction History**: Filter by type "PARTNER" to see all grants
- **User Revenue reports**: Track usage of Partner Credits alongside other credit types
- **Individual user profiles**: View detailed credit balance and transaction history

### 4.6. Technical Implementation Details

#### Database Schema

The `creditPartner` field is stored in the user document:

```
users/{userId}
  ├── creditAwards: number
  ├── creditPurchases: number
  ├── creditPartner: number  // Monthly allowance
  └── ...
```

#### Cloud Function Schedule

The `creditPartner` function is triggered by Cloud Scheduler with the following configuration:

- **Frequency**: Monthly
- **Schedule**: `0 0 1 * *` (midnight UTC on the 1st)
- **Timezone**: UTC
- **Retry policy**: Automatic retry on failure

#### Transaction Record Structure

```
transactions/{transactionId}
  ├── type: "PARTNER"
  ├── amount: number
  ├── userId: string
  ├── timestamp: timestamp
  ├── creditPurchases: number  // Balance after grant
  └── ...
```

### 4.7. Best Practices

#### For Administrators

- **Document partnership agreements** that include credit allowances
- **Review Partner Credit usage** monthly to ensure appropriate allocation
- **Set reasonable allowances** based on expected deployment costs
- **Monitor for abuse** by checking transaction history regularly
- **Communicate with users** about their monthly allowance and grant schedule
- **Plan for timezone differences** - grants occur at midnight UTC

#### For Users with Partner Credits

- **Understand the grant schedule** - credits arrive on the 1st of each month
- **Monitor your balance** to ensure sufficient credits for planned deployments
- **Use credits efficiently** as they don't expire but represent a monthly cap
- **Contact administrators** if allowance needs adjustment based on usage patterns

### 4.8. Troubleshooting

#### Credits Not Granted

If Partner Credits don't appear on the expected date:

1. **Verify the allowance is set** - Check the Partner column shows a value > 0
2. **Check the Cloud Function logs** - Review `creditPartner` function execution
3. **Confirm the schedule** - Ensure Cloud Scheduler is active
4. **Review transaction history** - Look for PARTNER type transactions
5. **Check user's creditPurchases balance** - Verify it increased by the allowance amount

#### Incorrect Allowance Amount

If the wrong amount was granted:

1. **Review the Partner field value** at the time of grant
2. **Check transaction history** for the actual granted amount
3. **Manually adjust** the user's balance if needed using the credit adjustment feature
4. **Update the Partner field** for future months

#### User Cannot Use Partner Credits

If a user reports inability to use Partner Credits:

1. **Verify credits were granted** - Check transaction history
2. **Confirm creditPurchases balance** - Ensure credits are in the account
3. **Check deployment requirements** - Verify the module doesn't have other restrictions
4. **Review total available credits** - Ensure sufficient balance for the deployment cost

### 4.9. Financial Reporting Considerations

Partner Credits impact financial reporting in the following ways:

- **Not revenue**: Partner Credits are granted, not purchased, so they don't generate revenue
- **Cost tracking**: Deployments using Partner Credits still incur actual cloud costs
- **Partner agreements**: Track Partner Credit usage separately for partnership accounting
- **Audit compliance**: Transaction history provides complete audit trail for Partner Credits
- **Revenue attribution**: Module revenue reports distinguish between purchased and partner credits

### 4.10. Security and Access Control

Access to Partner Credits management is restricted to:

- **Administrators only**: Only users with admin role can view and modify Partner allowances
- **Audit logging**: All changes to Partner allowances are logged
- **No self-service**: Users cannot set their own Partner allowances
- **Transaction integrity**: The automated system prevents manual manipulation of grant timing

## 5. Credit Types Summary

The RAD Platform now supports three distinct credit types:

### 5.1. Awarded Credits (`creditAwards`)

- **Source**: Signup bonuses, referrals, promotional campaigns, manual adjustments
- **Usage**: Can be used for any deployment
- **Restrictions**: Cannot be used for modules requiring purchased credits
- **Expiration**: Typically do not expire
- **Deduction priority**: Used first before purchased credits (for eligible modules)

### 5.2. Purchased Credits (`creditPurchases`)

- **Source**: Direct payment through subscription tiers
- **Usage**: Can be used for any deployment without restriction
- **Restrictions**: None
- **Expiration**: Do not expire
- **Deduction priority**: Used after awarded credits are exhausted (for eligible modules)

### 5.3. Partner Credits (added to `creditPurchases`)

- **Source**: Monthly automated grants based on administrator-set allowances
- **Usage**: Identical to purchased credits - unrestricted use
- **Restrictions**: None
- **Expiration**: Do not expire
- **Deduction priority**: Same as purchased credits
- **Key difference**: Granted automatically rather than purchased, but functionally equivalent

This three-tier system provides flexibility for different user types and business models while maintaining clear audit trails and usage tracking.

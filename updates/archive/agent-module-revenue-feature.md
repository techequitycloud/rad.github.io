# Agent Module Revenue Feature

## Overview
The Agent Module Revenue feature allows Agents to track revenue generated by the users they have referred to the platform. Agents earn a commission based on the "true revenue" generated by their referrals' deployments.

## Prerequisites
*   **Agent Role:** You must have the 'Agent' role assigned to your account.
*   **Referrals:** Users must be linked to your account via the `referredBy` field (typically set during signup via a referral code).

## How It Works

### Revenue Calculation
Revenue is calculated based on the "True Revenue" model:
1.  **Deployment Costs:** The credit cost of each deployment by a referred user is tracked.
2.  **Free Credit Deduction:** Revenue is only counted after a user has exhausted their free (awarded) credits.
    *   Deployments covered by free credits generate $0 revenue for the agent.
    *   Deployments paid for with purchased credits generate revenue.
3.  **Revenue Share:** Your commission is calculated as a percentage of the revenue generated.
    *   **Agent Share:** Defined by the `agentRevenueShare` setting.
    *   **Partner Share:** If you are also a Partner, you earn `partnerRevenueShare` for deployments of your own modules.
    *   **Additive Shares:** If you are both an Agent (referred the user) and a Partner (user deployed your module), you earn both shares.

### Backend Logic
*   **Data Source:** Revenue data combines user credit transaction history (Firestore) and deployment records (BigQuery/Firestore).
*   **Security:** Data is strictly filtered. You can only view revenue data for users where `user.referredBy === your_email`.

## How to Use

### 1. Accessing the Revenue Dashboard
Navigate to the **Revenue** page using the main navigation bar. This page is exclusive to Agents and Partners.

### 2. User Revenue Tab
This tab displays revenue broken down by individual user deployments.

*   **Filter by User:**
    *   Use the dropdown menu to select specific referred users.
    *   By default, you can view all your referrals.
*   **Filter by Date:**
    *   Select a **Start Date** and **End Date** to view revenue within a specific period.
*   **View Data:**
    *   The table shows: User Email, Module Name, Deployment Date, Credit Cost, and your Revenue Share.
*   **Export:**
    *   Click "Export to CSV" to download the current view for offline analysis.

### 3. Module Revenue Tab
This tab aggregates revenue by module, allowing you to see which modules are generating the most income from your referrals.

*   **View Data:**
    *   The table shows: Module Name, Deployment Count, Total Credit Cost, and Total Revenue.
*   **Export:**
    *   Download the aggregated data as a CSV file.

## Troubleshooting
*   **No Data Visible:** Ensure you have selected a date range. If you still see no data, your referred users may not have deployed any paid modules yet, or they may still be using free credits.
*   **Missing Users:** If a user is not in your dropdown list, confirm they signed up with your referral code.
